function xmCookie(a,b,c){if(arguments.length>1&&"[object Object]"!==String(b)){if(c=jQuery.extend({},c),(null===b||void 0===b)&&(c.expires=-1),"number"==typeof c.expires){var d=c.expires,e=c.expires=new Date;e.setDate(e.getDate()+d)}return b=String(b),document.cookie=[encodeURIComponent(a),"=",c.raw?b:encodeURIComponent(b),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}c=b||{};var f,g=c.raw?function(a){return a}:decodeURIComponent;return(f=new RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)").exec(document.cookie))?g(f[1]):null}function loginInfo_getAccountInfo(a){if(a.userId){var b={path:"/",domain:".mi.com"};loginInfo.userData.userName=a.uniqName?a.uniqName:a.userId,xmCookie("XM_"+loginInfo.userData.userId+"_UN",loginInfo.userData.userName,b),loginInfo.updateUserInfo()}}!function(){"use strict";function a(){var a={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},b=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(b,function(b){return a[b]||b}):this}}function b(a,c,d){return("string"==typeof c?c:c.toString()).replace(a.define||g,function(b,c,e,f){return 0===c.indexOf("def.")&&(c=c.substring(4)),c in d||(":"===e?(a.defineParams&&f.replace(a.defineParams,function(a,b,e){d[c]={arg:b,text:e}}),c in d||(d[c]=f)):new Function("def","def['"+c+"']="+f)(d)),""}).replace(a.use||g,function(c,e){a.useParams&&(e=e.replace(a.useParams,function(a,b,c,e){if(d[c]&&d[c].arg&&e){var f=(c+":"+e).replace(/'|\\/g,"_");return d.__exp=d.__exp||{},d.__exp[f]=d[c].text.replace(new RegExp("(^|[^\\w$])"+d[c].arg+"([^\\w$])","g"),"$1"+e+"$2"),b+"def.__exp['"+f+"']"}}));var f=new Function("def","return "+e)(d);return f?b(a,f,d):f})}function c(a){return a.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var d,e={version:"1.0.0",templateSettings:{evaluate:/\{\{([\s\S]+?\}?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:void 0,compile:void 0};"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):(d=function(){return this||(0,eval)("this")}(),d.doT=e),String.prototype.encodeHTML=a();var f={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},g=/$^/;e.template=function(d,h,i){h=h||e.templateSettings;var j,k,l=h.append?f.append:f.split,m=0,n=h.use||h.define?b(h,d,i||{}):d;n=("var out='"+(h.strip?n.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):n).replace(/'|\\/g,"\\$&").replace(h.interpolate||g,function(a,b){return l.start+c(b)+l.end}).replace(h.encode||g,function(a,b){return j=!0,l.start+c(b)+l.endencode}).replace(h.conditional||g,function(a,b,d){return b?d?"';}else if("+c(d)+"){out+='":"';}else{out+='":d?"';if("+c(d)+"){out+='":"';}out+='"}).replace(h.iterate||g,function(a,b,d,e){return b?(m+=1,k=e||"i"+m,b=c(b),"';var arr"+m+"="+b+";if(arr"+m+"){var "+d+","+k+"=-1,l"+m+"=arr"+m+".length-1;while("+k+"<l"+m+"){"+d+"=arr"+m+"["+k+"+=1];out+='"):"';} } out+='"}).replace(h.evaluate||g,function(a,b){return"';"+c(b)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),j&&h.selfcontained&&(n="String.prototype.encodeHTML=("+a.toString()+"());"+n);try{return new Function(h.varname,n)}catch(o){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+n),o}},e.compile=function(a,b){return e.template(a,null,b)}}();var openBuyHome=function(){function a(){xmCookie(openHomeConfig.config.cookie_isstart)?b():(f(),m=setInterval(function(){f()},6e5)),openHomeConfig.config.succValArr=xmCookie("XM_Buy_Succ")?xmCookie("XM_Buy_Succ").split(","):[]}function b(){$.ajax({type:"GET",url:openHomeConfig.config.hdinfo_url,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"hdinfo",timeout:1e4,error:function(){c()},success:function(a){a&&d(a.status)}})}function c(){$.ajax({type:"GET",url:openHomeConfig.config.getpath_url,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"getpath",timeout:15e3,error:function(){location.reload()},success:function(a){a&&a.path?(openHomeConfig.config.buy_url=openHomeConfig.config.buy_url.replace("{{PATH}}",a.path),e()):location.reload()}})}function d(a){for(var b=!0,d=xmCookie(openHomeConfig.config.cookie_userid),f=0;f<openHomeConfig.productInfo.length;f+=1){for(var g=!0,h=0;h<openHomeConfig.productInfo[f].vercatData.length;h+=1){var i=openHomeConfig.productInfo[f].vercatData[h].goods_id;a[i]||(a[i]={hdstart:!1,hdstop:!0}),a[i].hdstart===!0&&a[i].hdstop===!1&&(g=!1),$.inArray(i,openHomeConfig.config.succValArr)>=0&&$.inArray(d,openHomeConfig.config.succValArr)>=0&&(openHomeConfig.productInfo[f].buySucc=!0)}g?openHomeConfig.productInfo[f].status=0:(openHomeConfig.productInfo[f].status=1,b=!1),"mitv40"===openHomeConfig.productInfo[f].product_en&&xmCookie("xm_mitv40_over")&&(openHomeConfig.productInfo[f].status=0),"air"===openHomeConfig.productInfo[f].product_en&&xmCookie("xm_air_over")&&(openHomeConfig.productInfo[f].status=0)}b?(openHomeConfig.config.hdstatus=0,e()):(openHomeConfig.config.hdstatus=1,c())}function e(){for(var a=0;a<openHomeConfig.productInfo.length;a+=1){var b,c=o.children('[data-pro="'+openHomeConfig.productInfo[a].product_en+'"]').find(".J_proBtn");if(1===openHomeConfig.productInfo[a].status)b=openHomeConfig.config.buy_url.replace("{{PRO}}",openHomeConfig.productInfo[a].product_en),c.attr("href",b).html(openHomeConfig.productInfo[a].btn_buy_text).removeClass("btn-disabled").next(".info").html(openHomeConfig.productInfo[a].buy_on_msg);else if(0===openHomeConfig.productInfo[a].status)if(openHomeConfig.productInfo[a].buySucc){for(var d=0;d<openHomeConfig.productInfo[a].vercatData.length;d+=1)if($.inArray(openHomeConfig.productInfo[a].vercatData[d].goods_id,openHomeConfig.config.succValArr)>=0){c.attr("href",openHomeConfig.config.succ_pay_url+openHomeConfig.productInfo[a].vercatData[d].goods_id).html(openHomeConfig.productInfo[a].btn_pay_text).removeClass("btn-disabled");break}}else"0"!==openHomeConfig.commonConfig.next_reg_id&&openHomeConfig.productInfo[a].book_tag?c.attr("href","http://a.hd.mi.com/productv2/book/s/"+openHomeConfig.productInfo[a].book_tag+"/a/"+openHomeConfig.commonConfig.next_reg_id+"/"+q).html(openHomeConfig.productInfo[a].btn_nextbook_text).removeClass("btn-disabled").next(".info").html(openHomeConfig.productInfo[a].product_name+"已售罄 "+openHomeConfig.productInfo[a].over_msg):c.html(openHomeConfig.productInfo[a].btn_over_text).addClass("btn-disabled").next(".info").html(openHomeConfig.productInfo[a].over_msg)}}function f(){$.ajax({type:"GET",url:openHomeConfig.config.server_time_url,dataType:"script",timeout:5e3,error:function(){g()},success:function(){"undefined"!=typeof servertime&&servertime?h():g()}})}function g(){var a=parseInt((new Date).getTime()/1e3);servertime=a+3600*(8-(new Date).getTimezoneOffset()/60*-1),h()}function h(){if(servertime<openHomeConfig.commonConfig.cur_reg_endtime)i();else if(servertime<openHomeConfig.commonConfig.starttime){$(".J_accBox").hide();for(var a=0;a<openHomeConfig.productInfo.length;a+=1)o.children('[data-pro="'+openHomeConfig.productInfo[a].product_en+'"]').find(".J_proBtn").removeAttr("href").addClass("btn-disabled");n&&clearInterval(n),n=setInterval(function(){j()},1e3)}else xmCookie(openHomeConfig.config.cookie_isstart,"1",{path:"/",domain:".mi.com",expires:1}),b()}function i(){var a=doT.template('{{~it :value:index}}<li><a href="{{=\'http://www.mi.com/item/\' + value.commodity_id}}"><img src="{{=value.image}}?width=220&height=220" alt="{{=value.name}}"></a><h3 class="title">{{=value.name}}</h3><p class="desc">{{=value.brief}}</p><p class="price">{{? Number(value.price) > 0}}{{=value.price}}元{{? Number(value.market_price) > Number(value.price)}}<del>{{=value.market_price}}元</del>{{?}}{{?}}</p></li>{{~}}');if(peijianData)for(var b in peijianData)if(peijianData.hasOwnProperty(b)){var c=p.find('[data-pro="'+b+'"]');c.find(".J_accBox").show(),c.find(".J_accList").html(a(peijianData[b])),discountData&&discountData[b].discount_total&&c.find(".J_accDiscount").text(discountData[b].discount_total)}for(var d=0;d<openHomeConfig.productInfo.length;d+=1){var e=o.children('[data-pro="'+openHomeConfig.productInfo[d].product_en+'"]').find(".J_proBtn"),f=p.children('[data-pro="'+openHomeConfig.productInfo[d].product_en+'"]').find(".J_proLink"),g="http://a.hd.mi.com/productv2/book/a/";g+=openHomeConfig.productInfo[d].book_tag?openHomeConfig.commonConfig.cur_reg_id+"/s/"+openHomeConfig.productInfo[d].book_tag+"/"+q:openHomeConfig.commonConfig.cur_reg_id+"/"+q,e.attr("href",g).removeClass("btn-disabled").html("立即预约"),f.attr("href",g)}}function j(){var a=openHomeConfig.commonConfig.starttime,b=a-servertime;if(b>0){var c,d,e=Math.floor(b%60),f=Math.floor(b/60%60),g=Math.floor(b/3600%24),h=Math.floor(b/86400%30);h>0&&(g+=24*h),servertime+=1,c=[e.toString(),f.toString(),g.toString(),h.toString()],d="<i>"+c[2]+"</i>小时<i>"+c[1]+"</i>分<i>"+c[0]+"</i>秒后 开售",0===g&&(d="<i>"+c[1]+"</i>分<i>"+c[0]+"</i>秒后 开售",0===f&&(d="<i>"+c[0]+"</i>秒后 开售")),$(".J_proBtn").html(d).addClass("btn-countdown"),0===g&&k()}else l()}function k(){var a=openHomeConfig.commonConfig.starttime-openHomeConfig.config.pre_log_sec,b=openHomeConfig.commonConfig.starttime-openHomeConfig.config.pre_reset_sec;return!(servertime>=a)||xmCookie(openHomeConfig.config.cookie_userid)&&xmCookie(openHomeConfig.config.cookie_login_1)&&xmCookie(openHomeConfig.config.cookie_login_2)?void(servertime>=b&&!openHomeConfig.config.is_check_servertime&&(m&&clearInterval(m),m=setInterval(function(){f()},12e4),openHomeConfig.config.is_check_servertime=!0)):(clearInterval(n),$(".J_proBtn").attr("href",openHomeConfig.config.login_url).html("提前登录").removeClass("btn-disabled btn-countdown"),!1)}function l(){clearInterval(n),clearInterval(m),xmCookie(openHomeConfig.config.cookie_isstart,"1",{path:"/",domain:".mi.com",expires:1}),$(".J_proBtn").html("正在加载...").removeClass("btn-countdown"),c()}var m=0,n=0,o=$("#J_proInfo"),p=$("#J_proDetail"),q=parseInt((new Date).getTime()/1e3)+Math.floor(9e4*Math.random()+1e4);openHomeConfig.config.hdstatus=1;for(var r=0;r<openHomeConfig.productInfo.length;r+=1)openHomeConfig.productInfo[r].status=1;return{init:a}}(),loginInfo=function(){function a(){var a=$("#J_loginLink");a.length&&a.html("欢迎你，"+c.userName+'！<a href="http://order.mi.com/site/logout">退出</a>')}function b(){if(c.userId=xmCookie(openHomeConfig.config.cookie_userid),!c.userId)return!1;var b=$('<iframe src="http://hd.account.xiaomi.com/lmt/limit-for-account.html" height="0" width="0" frameborder="0" class="hide"></iframe>');if($("body").append(b),c.userName=c.userId?xmCookie("XM_"+c.userId+"_UN"):"",null===c.userName||""===c.userName){var d=document.createElement("script");d.src="https://account.xiaomi.com/pass/userInfoJsonP?userId="+c.userId+"&callback=loginInfo_getAccountInfo",d.type="text/javascript",d.async=!0,document.getElementsByTagName("head")[0].appendChild(d)}else a()}var c={userId:0,userName:""};return{userData:c,updateUserInfo:a,init:b}}(),openHome=function(){function a(b,c){function d(a){e.eq(a).fadeIn(i.duration).siblings().fadeOut(i.duration),i.pager&&g.children(".page").eq(a).addClass("active").siblings().removeClass("active")}var e,f,g,h,i,j,k=$(b),l="",m='<a class="slide-previous">上一页</a><a class="slide-next">下一页</a>',n=0;return 0===k.length?k:k.length>1?(k.each(function(){a($(this),c)}),k):(h={itemSelector:".slide",control:!0,pager:!0,auto:!1,delay:5e3,duration:300},i=$.extend({},h,c),e=k.find(i.itemSelector),e.length<=1?b:(f=e.wrapAll('<div class="slides-wrapper"></div>'),i.pager&&(l='<div class="pagination">',e.each(function(a){l+='<a class="page" href="javascript: void(0);">'+a+"</a>"}),l+="</div>",g=$(l),k.append(g),g.children(".page").on("click",function(a){a.preventDefault(),n=$(this).index(),d(n)})),i.control&&(k.append($(m)),k.find(".slide-previous").on("click",function(a){a.preventDefault(),n-=1,0>n&&(n=e.length-1),d(n)}),k.find(".slide-next").on("click",function(a){a.preventDefault(),n+=1,n>e.length-1&&(n=0),d(n)})),i.auto&&(j=setInterval(function(){n+=1,n>e.length-1&&(n=0),d(n)},i.delay)),void d(n)))}function b(){var b=location.hash.slice(1),g=$("#J_proNav").children('[data-pro="'+b+'"]');d.on("click",function(a){var b=$(this).attr("data-pro"),d=e.find('[data-pro="'+b+'"]');a.preventDefault(),$(this).addClass("active").siblings(".item").removeClass("active"),c.removeClass("style-light style-dark").addClass("style-"+$(this).attr("data-style")).css({"background-image":"url("+$(this).attr("data-bgi")+")","background-color":$(this).attr("data-bgc")}),d.show().addClass("xm-animate-fadeIn").siblings(".section").hide(),f.find('[data-pro="'+b+'"]').show().siblings(".section").hide(),location.hash="#"+b}),a($(".J_slideshow"),null),b&&g.length?g.trigger("click"):d.eq(0).trigger("click")}var c=$("#J_pageHeader"),d=$("#J_proNav").children(".item"),e=$("#J_proInfo"),f=$("#J_proDetail");return{init:b}}();jQuery(function(){loginInfo.init(),openHome.init(),openBuyHome.init()});
